<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>pytorch学习2 | Hello World!</title><meta name="author" content="Charlie Chen"><meta name="copyright" content="Charlie Chen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Pytorch学习2常见的transformer ​        下面我们通过Run Demo的方式来实现记忆常见的transformer！ ​        这是我们要处理的图片：  PIL-Image库读入图片​        下面通过PIL的Image库来读取图片文件： from PIL import Image img &#x3D; Image.open(&quot;1.png&amp;quot">
<meta property="og:type" content="article">
<meta property="og:title" content="pytorch学习2">
<meta property="og:url" content="http://charliechen114514.github.io/2023/05/28/pytorch%E5%AD%A6%E4%B9%A02/index.html">
<meta property="og:site_name" content="Hello World!">
<meta property="og:description" content="Pytorch学习2常见的transformer ​        下面我们通过Run Demo的方式来实现记忆常见的transformer！ ​        这是我们要处理的图片：  PIL-Image库读入图片​        下面通过PIL的Image库来读取图片文件： from PIL import Image img &#x3D; Image.open(&quot;1.png&amp;quot">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://charliechen114514.github.io/img/passagepage.png">
<meta property="article:published_time" content="2023-05-28T13:51:20.000Z">
<meta property="article:modified_time" content="2023-05-28T13:52:01.897Z">
<meta property="article:author" content="Charlie Chen">
<meta property="article:tag" content="pytorch">
<meta property="article:tag" content="python">
<meta property="article:tag" content="AI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://charliechen114514.github.io/img/passagepage.png"><link rel="shortcut icon" href="/img/webicon.png"><link rel="canonical" href="http://charliechen114514.github.io/2023/05/28/pytorch%E5%AD%A6%E4%B9%A02/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'pytorch学习2',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-28 21:52:01'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/webicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">86</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 大爹们</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/passagepage.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Hello World!"><span class="site-name">Hello World!</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 大爹们</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">pytorch学习2</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-28T13:51:20.000Z" title="发表于 2023-05-28 21:51:20">2023-05-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-28T13:52:01.897Z" title="更新于 2023-05-28 21:52:01">2023-05-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>11分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="pytorch学习2"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Pytorch学习2"><a href="#Pytorch学习2" class="headerlink" title="Pytorch学习2"></a>Pytorch学习2</h1><h2 id="常见的transformer"><a href="#常见的transformer" class="headerlink" title="常见的transformer"></a>常见的transformer</h2><p><img src="image-20230503184731008.png" alt="image-20230503184731008"></p>
<p>​        下面我们通过Run Demo的方式来实现记忆常见的transformer！</p>
<p>​        这是我们要处理的图片：</p>
<p><img src="image-20230503185022804.png" alt="image-20230503185022804"></p>
<h3 id="PIL-Image库读入图片"><a href="#PIL-Image库读入图片" class="headerlink" title="PIL-Image库读入图片"></a>PIL-Image库读入图片</h3><p>​        下面通过PIL的Image库来读取图片文件：</p>
<pre class="line-numbers language-C++" data-language="C++"><code class="language-C++">from PIL import Image
img &#x3D; Image.open(&quot;1.png&quot;);
print(img);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">&lt;PIL.PngImagePlugin.PngImageFile image mode&#x3D;RGBA size&#x3D;1717x1227 at 0x21AEC1CB880&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>​        这是我们得到的！导入成功！</p>
<h4 id="小插曲：-call-的用法"><a href="#小插曲：-call-的用法" class="headerlink" title="小插曲： __call__的用法"></a>小插曲： __call__的用法</h4><p>​        在Python类里存在内置函数__call__，我们这样的使用它：我们选择新建一个Python文件，</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"__call__ calls for:"</span><span class="token operator">+</span> <span class="token string">"hello"</span><span class="token operator">+</span><span class="token string">"name"</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token operator">+</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

person <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token punctuation">)</span>
person<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">)</span>
person<span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>​        书写上面的代码</p>
<p><img src="image-20230503190321481.png" alt="image-20230503190321481"></p>
<p>​        有点像C++的内置构建函数的感觉，只需要类对象（）后传对应参数就好了。</p>
<h4 id="继续："><a href="#继续：" class="headerlink" title="继续："></a>继续：</h4><p>​        看看这个Compose类：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Compose</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Composes several transforms together. This transform does not support torchscript.
    Please, see the note below.

    Args:
        transforms (list of ``Transform`` objects): list of transforms to compose.

    Example:
        >>> transforms.Compose([
        >>>     transforms.CenterCrop(10),
        >>>     transforms.PILToTensor(),
        >>>     transforms.ConvertImageDtype(torch.float),
        >>> ])

    .. note::
        In order to script the transformations, please use ``torch.nn.Sequential`` as below.

        >>> transforms = torch.nn.Sequential(
        >>>     transforms.CenterCrop(10),
        >>>     transforms.Normalize((0.485, 0.456, 0.406), (0.229, 0.224, 0.225)),
        >>> )
        >>> scripted_transforms = torch.jit.script(transforms)

        Make sure to use only scriptable transformations, i.e. that work with ``torch.Tensor``, does not require
        `lambda` functions or ``PIL.Image``.

    """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> transforms<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> torch<span class="token punctuation">.</span>jit<span class="token punctuation">.</span>is_scripting<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> torch<span class="token punctuation">.</span>jit<span class="token punctuation">.</span>is_tracing<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            _log_api_usage_once<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>transforms <span class="token operator">=</span> transforms

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> t <span class="token keyword">in</span> self<span class="token punctuation">.</span>transforms<span class="token punctuation">:</span>
            img <span class="token operator">=</span> t<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
        <span class="token keyword">return</span> img

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        format_string <span class="token operator">=</span> self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__ <span class="token operator">+</span> <span class="token string">"("</span>
        <span class="token keyword">for</span> t <span class="token keyword">in</span> self<span class="token punctuation">.</span>transforms<span class="token punctuation">:</span>
            format_string <span class="token operator">+=</span> <span class="token string">"\n"</span>
            format_string <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"    </span><span class="token interpolation"><span class="token punctuation">&#123;</span>t<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
        format_string <span class="token operator">+=</span> <span class="token string">"\n)"</span>
        <span class="token keyword">return</span> format_string


<span class="token keyword">class</span> <span class="token class-name">ToTensor</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Convert a PIL Image or ndarray to tensor and scale the values accordingly.

    This transform does not support torchscript.

    Converts a PIL Image or numpy.ndarray (H x W x C) in the range
    [0, 255] to a torch.FloatTensor of shape (C x H x W) in the range [0.0, 1.0]
    if the PIL Image belongs to one of the modes (L, LA, P, I, F, RGB, YCbCr, RGBA, CMYK, 1)
    or if the numpy.ndarray has dtype = np.uint8

    In the other cases, tensors are returned without scaling.

    .. note::
        Because the input image is scaled to [0.0, 1.0], this transformation should not be used when
        transforming target image masks. See the `references`_ for implementing the transforms for image masks.

    .. _references: https://github.com/pytorch/vision/tree/main/references/segmentation
    """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        _log_api_usage_once<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pic<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Args:
            pic (PIL Image or numpy.ndarray): Image to be converted to tensor.

        Returns:
            Tensor: Converted image.
        """</span>
        <span class="token keyword">return</span> F<span class="token punctuation">.</span>to_tensor<span class="token punctuation">(</span>pic<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">&#125;</span></span><span class="token string">()"</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>​            先看后面的ToTensor这个类，其负责把一些PIL Image数据转换为Tensor数据类型，举个例子，就处理我刚刚说的那张图片！</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> transforms
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>tensorboard <span class="token keyword">import</span> SummaryWriter
writer <span class="token operator">=</span> SummaryWriter<span class="token punctuation">(</span><span class="token string">"logs"</span><span class="token punctuation">)</span>
img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"1.png"</span><span class="token punctuation">)</span>

trans <span class="token operator">=</span> transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>
img_tensor <span class="token operator">=</span> trans<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
writer<span class="token punctuation">.</span>add_image<span class="token punctuation">(</span><span class="token string">"ToTensor"</span><span class="token punctuation">,</span>img_tensor<span class="token punctuation">)</span>
writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="To-PILImage"><a href="#To-PILImage" class="headerlink" title="To PILImage"></a>To PILImage</h3><pre class="line-numbers language-C++" data-language="C++"><code class="language-C++">class ToPILImage:
    &quot;&quot;&quot;Convert a tensor or an ndarray to PIL Image - this does not scale values.

    This transform does not support torchscript.

    Converts a torch.*Tensor of shape C x H x W or a numpy ndarray of shape
    H x W x C to a PIL Image while preserving the value range.

    Args:
        mode (&#96;PIL.Image mode&#96;_): color space and pixel depth of input data (optional).
            If &#96;&#96;mode&#96;&#96; is &#96;&#96;None&#96;&#96; (default) there are some assumptions made about the input data:
            - If the input has 4 channels, the &#96;&#96;mode&#96;&#96; is assumed to be &#96;&#96;RGBA&#96;&#96;.
            - If the input has 3 channels, the &#96;&#96;mode&#96;&#96; is assumed to be &#96;&#96;RGB&#96;&#96;.
            - If the input has 2 channels, the &#96;&#96;mode&#96;&#96; is assumed to be &#96;&#96;LA&#96;&#96;.
            - If the input has 1 channel, the &#96;&#96;mode&#96;&#96; is determined by the data type (i.e &#96;&#96;int&#96;&#96;, &#96;&#96;float&#96;&#96;,
            &#96;&#96;short&#96;&#96;).

    .. _PIL.Image mode: https:&#x2F;&#x2F;pillow.readthedocs.io&#x2F;en&#x2F;latest&#x2F;handbook&#x2F;concepts.html#concept-modes
    &quot;&quot;&quot;

    def __init__(self, mode&#x3D;None):
        _log_api_usage_once(self)
        self.mode &#x3D; mode

    def __call__(self, pic):
        &quot;&quot;&quot;
        Args:
            pic (Tensor or numpy.ndarray): Image to be converted to PIL Image.

        Returns:
            PIL Image: Image converted to PIL Image.

        &quot;&quot;&quot;
        return F.to_pil_image(pic, self.mode)

    def __repr__(self) -&gt; str:
        format_string &#x3D; self.__class__.__name__ + &quot;(&quot;
        if self.mode is not None:
            format_string +&#x3D; f&quot;mode&#x3D;&#123;self.mode&#125;&quot;
        format_string +&#x3D; &quot;)&quot;
        return format_string<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>​        把其他数据转换成PIL数据类型，不多讲，当成接口就好！</p>
<h3 id="Normalize方法类"><a href="#Normalize方法类" class="headerlink" title="Normalize方法类"></a>Normalize方法类</h3><p>​        </p>
<pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">class Normalize(torch.nn.Module):
    &quot;&quot;&quot;Normalize a tensor image with mean and standard deviation.
    This transform does not support PIL Image.
    Given mean: &#96;&#96;(mean[1],...,mean[n])&#96;&#96; and std: &#96;&#96;(std[1],..,std[n])&#96;&#96; for &#96;&#96;n&#96;&#96;
    channels, this transform will normalize each channel of the input
    &#96;&#96;torch.*Tensor&#96;&#96; i.e.,
    &#96;&#96;output[channel] &#x3D; (input[channel] - mean[channel]) &#x2F; std[channel]&#96;&#96;

    .. note::
        This transform acts out of place, i.e., it does not mutate the input tensor.

    Args:
        mean (sequence): Sequence of means for each channel.
        std (sequence): Sequence of standard deviations for each channel.
        inplace(bool,optional): Bool to make this operation in-place.

    &quot;&quot;&quot;

    def __init__(self, mean, std, inplace&#x3D;False):
        super().__init__()
        _log_api_usage_once(self)
        self.mean &#x3D; mean
        self.std &#x3D; std
        self.inplace &#x3D; inplace

    def forward(self, tensor: Tensor) -&gt; Tensor:
        &quot;&quot;&quot;
        Args:
            tensor (Tensor): Tensor image to be normalized.

        Returns:
            Tensor: Normalized Tensor image.
        &quot;&quot;&quot;
        return F.normalize(tensor, self.mean, self.std, self.inplace)

    def __repr__(self) -&gt; str:
        return f&quot;&#123;self.__class__.__name__&#125;(mean&#x3D;&#123;self.mean&#125;, std&#x3D;&#123;self.std&#125;)&quot;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>​        说白了这个就是标准化过程！重要的是这个公式</p>
<pre class="line-numbers language-none"><code class="language-none">output[channel] &#x3D; (input[channel] - mean[channel]) &#x2F; std[channel]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="Resize"><a href="#Resize" class="headerlink" title="Resize"></a>Resize</h3><pre class="line-numbers language-C++" data-language="C++"><code class="language-C++">class Resize(torch.nn.Module):
    &quot;&quot;&quot;Resize the input image to the given size.
    If the image is torch Tensor, it is expected
    to have [..., H, W] shape, where ... means an arbitrary number of leading dimensions

    .. warning::
        The output image might be different depending on its type: when downsampling, the interpolation of PIL images
        and tensors is slightly different, because PIL applies antialiasing. This may lead to significant differences
        in the performance of a network. Therefore, it is preferable to train and serve a model with the same input
        types. See also below the &#96;&#96;antialias&#96;&#96; parameter, which can help making the output of PIL images and tensors
        closer.

    Args:
        size (sequence or int): Desired output size. If size is a sequence like
            (h, w), output size will be matched to this. If size is an int,
            smaller edge of the image will be matched to this number.
            i.e, if height &gt; width, then image will be rescaled to
            (size * height &#x2F; width, size).

            .. note::
                In torchscript mode size as single int is not supported, use a sequence of length 1: &#96;&#96;[size, ]&#96;&#96;.
        interpolation (InterpolationMode): Desired interpolation enum defined by
            :class:&#96;torchvision.transforms.InterpolationMode&#96;. Default is &#96;&#96;InterpolationMode.BILINEAR&#96;&#96;.
            If input is Tensor, only &#96;&#96;InterpolationMode.NEAREST&#96;&#96;, &#96;&#96;InterpolationMode.NEAREST_EXACT&#96;&#96;,
            &#96;&#96;InterpolationMode.BILINEAR&#96;&#96; and &#96;&#96;InterpolationMode.BICUBIC&#96;&#96; are supported.
            The corresponding Pillow integer constants, e.g. &#96;&#96;PIL.Image.BILINEAR&#96;&#96; are accepted as well.
        max_size (int, optional): The maximum allowed for the longer edge of
            the resized image: if the longer edge of the image is greater
            than &#96;&#96;max_size&#96;&#96; after being resized according to &#96;&#96;size&#96;&#96;, then
            the image is resized again so that the longer edge is equal to
            &#96;&#96;max_size&#96;&#96;. As a result, &#96;&#96;size&#96;&#96; might be overruled, i.e. the
            smaller edge may be shorter than &#96;&#96;size&#96;&#96;. This is only supported
            if &#96;&#96;size&#96;&#96; is an int (or a sequence of length 1 in torchscript
            mode).
        antialias (bool, optional): Whether to apply antialiasing.
            It only affects **tensors** with bilinear or bicubic modes and it is
            ignored otherwise: on PIL images, antialiasing is always applied on
            bilinear or bicubic modes; on other modes (for PIL images and
            tensors), antialiasing makes no sense and this parameter is ignored.
            Possible values are:

            - &#96;&#96;True&#96;&#96;: will apply antialiasing for bilinear or bicubic modes.
              Other mode aren&#39;t affected. This is probably what you want to use.
            - &#96;&#96;False&#96;&#96;: will not apply antialiasing for tensors on any mode. PIL
              images are still antialiased on bilinear or bicubic modes, because
              PIL doesn&#39;t support no antialias.
            - &#96;&#96;None&#96;&#96;: equivalent to &#96;&#96;False&#96;&#96; for tensors and &#96;&#96;True&#96;&#96; for
              PIL images. This value exists for legacy reasons and you probably
              don&#39;t want to use it unless you really know what you are doing.

            The current default is &#96;&#96;None&#96;&#96; **but will change to** &#96;&#96;True&#96;&#96; **in
            v0.17** for the PIL and Tensor backends to be consistent.
    &quot;&quot;&quot;

    def __init__(self, size, interpolation&#x3D;InterpolationMode.BILINEAR, max_size&#x3D;None, antialias&#x3D;&quot;warn&quot;):
        super().__init__()
        _log_api_usage_once(self)
        if not isinstance(size, (int, Sequence)):
            raise TypeError(f&quot;Size should be int or sequence. Got &#123;type(size)&#125;&quot;)
        if isinstance(size, Sequence) and len(size) not in (1, 2):
            raise ValueError(&quot;If size is a sequence, it should have 1 or 2 values&quot;)
        self.size &#x3D; size
        self.max_size &#x3D; max_size

        if isinstance(interpolation, int):
            interpolation &#x3D; _interpolation_modes_from_int(interpolation)

        self.interpolation &#x3D; interpolation
        self.antialias &#x3D; antialias

    def forward(self, img):
        &quot;&quot;&quot;
        Args:
            img (PIL Image or Tensor): Image to be scaled.

        Returns:
            PIL Image or Tensor: Rescaled image.
        &quot;&quot;&quot;
        return F.resize(img, self.size, self.interpolation, self.max_size, self.antialias)

    def __repr__(self) -&gt; str:
        detail &#x3D; f&quot;(size&#x3D;&#123;self.size&#125;, interpolation&#x3D;&#123;self.interpolation.value&#125;, max_size&#x3D;&#123;self.max_size&#125;, antialias&#x3D;&#123;self.antialias&#125;)&quot;
        return f&quot;&#123;self.__class__.__name__&#125;&#123;detail&#125;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
trans_size <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">520</span><span class="token punctuation">,</span><span class="token number">520</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
imgResize <span class="token operator">=</span> trans_size<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>imgResize<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>​        这样就好了！</p>
<p><img src="image-20230503193919990.png" alt="image-20230503193919990"></p>
<h2 id="Compose-组合变换"><a href="#Compose-组合变换" class="headerlink" title="Compose 组合变换"></a>Compose 组合变换</h2><pre class="line-numbers language-none"><code class="language-none">trans_resize_2 &#x3D; transforms.Resize(512)
trans_compose &#x3D; transforms.Compose([trans_resize_2, trans])
img_resize_2 &#x3D; trans_compose(img)
writer.add_image(&quot;Composer111&quot;, img_resize_2,2)
writer.close()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>​        我们这样把若干变换组合在一起一并完成！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Charliechen114514">Charlie Chen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://charliechen114514.github.io/2023/05/28/pytorch%E5%AD%A6%E4%B9%A02/">http://charliechen114514.github.io/2023/05/28/pytorch%E5%AD%A6%E4%B9%A02/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">全体目光向我看齐，我宣布个事！是我Charliechen写的这篇文章！(?)</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pytorch/">pytorch</a><a class="post-meta__tags" href="/tags/python/">python</a><a class="post-meta__tags" href="/tags/AI/">AI</a></div><div class="post_share"><div class="social-share" data-image="/img/passagepage.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/05/28/pytorch%E5%AD%A6%E4%B9%A03/" title="pytorch学习3"><img class="cover" src="/img/passagepage.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">pytorch学习3</div></div></a></div><div class="next-post pull-right"><a href="/2023/05/28/QT-NEW-12-13/" title="QT NEW 12-13"><img class="cover" src="/img/passagepage.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">QT NEW 12-13</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/03/29/pytorch-1/" title="pytorch 1"><img class="cover" src="/img/passagepage.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-29</div><div class="title">pytorch 1</div></div></a></div><div><a href="/2023/05/28/pytorch%E5%AD%A6%E4%B9%A04/" title="pytorch学习4"><img class="cover" src="/img/passagepage.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-28</div><div class="title">pytorch学习4</div></div></a></div><div><a href="/2023/05/28/pytorch%E5%AD%A6%E4%B9%A05/" title="pytorch学习5"><img class="cover" src="/img/passagepage.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-28</div><div class="title">pytorch学习5</div></div></a></div><div><a href="/2023/05/28/pytorch%E5%AD%A6%E4%B9%A03/" title="pytorch学习3"><img class="cover" src="/img/passagepage.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-28</div><div class="title">pytorch学习3</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/webicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Charlie Chen</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">86</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Charliechen114514"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Charliechen114514" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=725610365&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">大更新！这下上了简单的数据结构的C实现，如果只对思路感兴趣看思路即可，如果想查看API实现就取看详解</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Pytorch%E5%AD%A6%E4%B9%A02"><span class="toc-number">1.</span> <span class="toc-text">Pytorch学习2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84transformer"><span class="toc-number">1.1.</span> <span class="toc-text">常见的transformer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PIL-Image%E5%BA%93%E8%AF%BB%E5%85%A5%E5%9B%BE%E7%89%87"><span class="toc-number">1.1.1.</span> <span class="toc-text">PIL-Image库读入图片</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E6%8F%92%E6%9B%B2%EF%BC%9A-call-%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">小插曲： __call__的用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E7%BB%AD%EF%BC%9A"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">继续：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#To-PILImage"><span class="toc-number">1.1.2.</span> <span class="toc-text">To PILImage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Normalize%E6%96%B9%E6%B3%95%E7%B1%BB"><span class="toc-number">1.1.3.</span> <span class="toc-text">Normalize方法类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Resize"><span class="toc-number">1.1.4.</span> <span class="toc-text">Resize</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compose-%E7%BB%84%E5%90%88%E5%8F%98%E6%8D%A2"><span class="toc-number">1.2.</span> <span class="toc-text">Compose 组合变换</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/05/Semester1-updateOfWholeNotes/" title="Semester1 updateOfWholeNotes"><img src="/img/passagepage.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Semester1 updateOfWholeNotes"/></a><div class="content"><a class="title" href="/2023/06/05/Semester1-updateOfWholeNotes/" title="Semester1 updateOfWholeNotes">Semester1 updateOfWholeNotes</a><time datetime="2023-06-05T03:50:36.000Z" title="发表于 2023-06-05 11:50:36">2023-06-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/03/Windows-API-%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%EF%BC%887-8%EF%BC%89/" title="Windows-API-程序设计（7,8）"><img src="/img/passagepage.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Windows-API-程序设计（7,8）"/></a><div class="content"><a class="title" href="/2023/06/03/Windows-API-%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%EF%BC%887-8%EF%BC%89/" title="Windows-API-程序设计（7,8）">Windows-API-程序设计（7,8）</a><time datetime="2023-06-03T02:23:40.000Z" title="发表于 2023-06-03 10:23:40">2023-06-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/01/Qt-Opencv-Config/" title="Qt &amp;&amp; Opencv Config"><img src="/img/passagepage.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Qt &amp;&amp; Opencv Config"/></a><div class="content"><a class="title" href="/2023/06/01/Qt-Opencv-Config/" title="Qt &amp;&amp; Opencv Config">Qt &amp;&amp; Opencv Config</a><time datetime="2023-06-01T13:31:25.000Z" title="发表于 2023-06-01 21:31:25">2023-06-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/31/Ros%E5%B0%8F%E8%BD%A6%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C%EF%BC%88%E6%B0%B4%EF%BC%81%EF%BC%89/" title="Ros小车简单操作（水！）"><img src="/img/passagepage.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ros小车简单操作（水！）"/></a><div class="content"><a class="title" href="/2023/05/31/Ros%E5%B0%8F%E8%BD%A6%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C%EF%BC%88%E6%B0%B4%EF%BC%81%EF%BC%89/" title="Ros小车简单操作（水！）">Ros小车简单操作（水！）</a><time datetime="2023-05-31T12:34:30.000Z" title="发表于 2023-05-31 20:34:30">2023-05-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/29/QT-new-14/" title="QT new 14"><img src="/img/passagepage.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="QT new 14"/></a><div class="content"><a class="title" href="/2023/05/29/QT-new-14/" title="QT new 14">QT new 14</a><time datetime="2023-05-29T09:14:07.000Z" title="发表于 2023-05-29 17:14:07">2023-05-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Charlie Chen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="哼啊啊啊啊啊啊啊啊啊啊啊啊,人民万岁！,兄啊，别点力" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>